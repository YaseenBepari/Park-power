<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UPI Payment</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    #bg-video {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
      filter: brightness(0.6);
    }

    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px 20px;
      background-color: #f7f7f7;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: white;
      position: relative;
      z-index: 1;
    }

    nav {
      background-color: #000;
      padding: 15px 20px;
      color: white;
      font-size: 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: relative;
      z-index: 2;
    }

    nav .logo {
      font-weight: bold;
      font-size: 22px;
    }

    nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 20px;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    nav ul li a:hover {
      color: #cce5ff;
    }

    .hamburger {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }

    .nav-links {
      display: flex;
      gap: 20px;
    }

    .nav-links.active {
      display: flex;
      flex-direction: column;
      position: absolute;
      top: 60px;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.9);
      padding: 10px 0;
      z-index: 3;
    }

    footer {
      background-color: #000;
      color: white;
      padding: 15px 20px;
      margin-top: auto;
      font-size: 14px;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: relative;
      z-index: 2;
    }

    footer .footer-left {
      font-weight: 500;
    }

    footer .footer-right a {
      color: white;
      text-decoration: none;
      margin-left: 15px;
      font-weight: 500;
    }

    footer .footer-right a:hover,
    footer .footer-right a:focus {
      text-decoration: underline;
    }

    h1 {
      color: #cce5ff;
      margin-top: 40px;
      text-shadow: 1px 1px 3px #000;
      font-size: 32px;
    }

    .scanner {
      margin-top: 30px;
    }

    .scanner p {
      font-size: 18px;
      margin-bottom: 15px;
    }

    .scanner img {
      width: 280px;
      height: 280px;
      max-width: 80%;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
    }

    button {
      padding: 10px 20px;
      margin-top: 30px;
      font-size: 16px;
      background-color: #5b9bd5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      max-width: 200px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: background-color 0.3s;
      min-height: 48px;
      touch-action: manipulation;
    }

    button:hover,
    button:focus {
      background-color: #4a8ac9;
    }

    .receipt {
      display: none;
      width: 90%;
      max-width: 800px;
      margin: 40px auto 0 auto;
      text-align: left;
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border: 1px solid #000;
      font-family: Arial, sans-serif;
      color: #000;
      position: relative;
      z-index: 2;
    }

    .header, .footer {
      display: flex;
      justify-content: space-between;
    }

    .receipt h2 {
      margin: 0;
      color: #333;
      font-size: 24px;
    }

    .bold { font-weight: bold; }

    .section { margin-top: 20px; }

    .line { border-top: 2px solid #000; margin-top: 10px; margin-bottom: 10px; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 16px;
    }

    table td, table th {
      padding: 8px;
      border-bottom: 1px solid #ccc;
    }

    .right { text-align: right; }

    .signature-qr {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .signature-qr img {
      height: 100px;
      max-width: 100%;
    }

    #printBtn {
      display: none;
      background-color: #28a745;
      margin-top: 20px;
      width: auto;
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      max-width: 280px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      min-height: 48px;
      touch-action: manipulation;
    }

    #printBtn:hover,
    #printBtn:focus {
      background-color: #218838;
    }

    #loadingMessage {
      display: none;
      margin-top: 10px;
      font-size: 14px;
      color: #cce5ff;
    }

    @media (max-width: 768px) {
      body {
        padding: 20px 10px;
      }

      nav {
        padding: 10px 15px;
      }

      nav .logo {
        font-size: 18px;
      }

      .hamburger {
        display: block;
      }

      .nav-links {
        display: none;
      }

      .nav-links.active {
        display: flex;
      }

      nav ul li a {
        font-size: 16px;
        padding: 10px 20px;
      }

      h1 {
        font-size: 24px;
        margin-top: 20px;
      }

      .scanner p {
        font-size: 16px;
      }

      .scanner img {
        width: 200px;
        height: 200px;
      }

      button {
        font-size: 14px;
        padding: 8px 16px;
        max-width: 180px;
      }

      .receipt {
        padding: 15px;
        margin: 20px auto 0 auto;
      }

      .receipt h2 {
        font-size: 18px;
      }

      .receipt p {
        font-size: 14px;
      }

      table {
        font-size: 14px;
      }

      table td, table th {
        padding: 6px;
      }

      .signature-qr {
        flex-direction: column;
        align-items: center;
      }

      .signature-qr img {
        height: 80px;
      }

      #printBtn {
        font-size: 16px;
        padding: 10px 20px;
        max-width: 240px;
      }

      footer {
        padding: 10px 15px;
        flex-direction: column;
        gap: 10px;
      }

      footer .footer-left,
      footer .footer-right {
        font-size: 12px;
      }

      footer .footer-right a {
        margin-left: 10px;
        padding: 5px;
      }

      #loadingMessage {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>

  <video autoplay muted loop playsinline id="bg-video">
    <source src="static/9790135-hd_1920_1080_30fps.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <nav>
    <div class="logo">PARK & POWER</div>
    <ul class="nav-links">
      <li><a href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('about_us') }}">About</a></li> 
      <li><a href="{{ url_for('sign_in') }}">Sign In</a></li>
      <li><a href="{{ url_for('sign_up') }}">Sign Up</a></li>
      <li><a href="{{ url_for('feedback') }}">Feedback</a></li>
      <li><a href="{{ url_for('parking_history') }}">Parking History</a></li>
    </ul>
    <button class="hamburger" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
  </nav>

  <h1>UPI Payment</h1>

  <div class="scanner">
    <p>Scan the QR code to complete your payment:</p>
    <img src="static/qr_code.png" alt="UPI QR Code" />
  </div>

  <button onclick="showReceipt()">Confirm Payment</button>

  <div class="receipt" id="receipt">
    <div class="header">
      <div>
        <h2>PARK & POWER Inc.</h2>
        <p>Wireless Charging Station <br>Hubli, NY 580024</p>
      </div>
      <div>
        <h2>ONLINE RECEIPT</h2>
        <p>
          <strong>Receipt #:</strong> US-001<br />
          <strong>Receipt Date:</strong> <span id="receiptDate"></span><br />
          <strong>Due Date:</strong> 29/05/2025
        </p>
      </div>
    </div>

    <div class="line"></div>

    <div class="section">
      <p><strong>Bill To:</strong><br />Yaseen<br />Hubli, India</p>
      <p id="vehicleNumber"><strong>Vehicle Number:</strong> AS-05-CJ-9964</p>
      <p id="parkingSlot"><strong>Parking Slot:</strong> 2</p>
      <p id="contactNumber"><strong>Contact:</strong> +91 0525048368</p>
      <p id="entryTime"><strong>Entry Time:</strong> 00:00:00</p>
      <p id="exitTime"><strong>Exit Time:</strong> 00:00:00</p>
      <p id="duration"><strong>Duration:</strong> 0 seconds</p>
    </div>

    <table>
      <thead>
        <tr>
          <th>QTY</th>
          <th id="descriptionHeader">DESCRIPTION</th>
          <th class="right">UNIT</th>
          <th class="right">AMOUNT</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td id="description">Parking Charges - 17 seconds</td>
          <td id="unitPrice" class="right">₹1.48</td>
          <td id="amount" class="right">₹1.48</td>
        </tr>
      </tbody>
    </table>

    <div class="right section">
      <p id="subtotal">Subtotal: ₹1.48</p>
      <p>GST (included)</p>
      <h3 id="total"><strong>Total: ₹1.48</strong></h3>
    </div>

    <div class="signature-qr">
      <div>
        <p class="bold">Authorized Signature:</p>
        <img src="static/signutre.png" alt="Signature" />
      </div>
      <div>
        <p class="bold">Scan for UPI:</p>
        <img src="static/qr_code.png" alt="QR Code" />
      </div>
    </div>
  </div>

  <div style="text-align: center;">
    <button id="printBtn" onclick="downloadPDF()">PRINT Receipt</button>
    <div id="loadingMessage">Sending email to yaseenbepari2002@gmail.com...</div>
  </div>

  <footer>
    <div class="footer-left">© 2025 PARK & POWER Inc.</div>
    <div class="footer-right">
      <a href="privacy.html">Privacy Policy</a>
      <a href="terms.html">Terms of Service</a>
    </div>
  </footer>

  <script>
    function showReceipt() {
      const parkingRecords = [
        {
          slot: 1,
          vehicleNumber: "VP-07-NA-6003",
          contactNumber: "+910276421070",
          entryTime: "00:00:13",
          exitTime: "00:00:45",
          duration: "27 seconds",
          totalCharge: "₹3.19",
        },
        {
          slot: 1,
          vehicleNumber: "CK-73-AX-3074",
          contactNumber: "+919518611573",
          entryTime: "00:08:21",
          exitTime: "00:08:39",
          duration: "13 seconds",
          totalCharge: "₹1.53",
        },
        {
          slot: 1,
          vehicleNumber: "XE-77-TN-3313",
          contactNumber: "+917583594753",
          entryTime: "00:01:04",
          exitTime: "00:02:12",
          duration: "63 seconds",
          totalCharge: "₹7.43",
        },
        {
          slot: 2,
          vehicleNumber: "JI-77-QW-7806",
          contactNumber: "+910907682382",
          entryTime: "00:00:59",
          exitTime: "00:01:18",
          duration: "15 seconds",
          totalCharge: "₹1.77",
        },
        {
          slot: 2,
          vehicleNumber: "IS-53-CL-2100",
          contactNumber: "+914464040351",
          entryTime: "00:07:09",
          exitTime: "00:07:27",
          duration: "14 seconds",
          totalCharge: "₹1.65",
        },
      ];

      const randomRecord = parkingRecords[Math.floor(Math.random() * parkingRecords.length)];

      document.getElementById('parkingSlot').innerHTML = `<strong>Parking Slot:</strong> ${randomRecord.slot}`;
      document.getElementById('vehicleNumber').innerHTML = `<strong>Vehicle Number:</strong> ${randomRecord.vehicleNumber}`;
      document.getElementById('contactNumber').innerHTML = `<strong>Contact:</strong> ${randomRecord.contactNumber}`;
      document.getElementById('entryTime').innerHTML = `<strong>Entry Time:</strong> ${randomRecord.entryTime}`;
      document.getElementById('exitTime').innerHTML = `<strong>Exit Time:</strong> ${randomRecord.exitTime}`;
      document.getElementById('duration').innerHTML = `<strong>Duration:</strong> ${randomRecord.duration}`;
      document.getElementById('description').innerHTML = `Parking Charges - ${randomRecord.duration}`;
      document.getElementById('unitPrice').innerHTML = randomRecord.totalCharge;
      document.getElementById('amount').innerHTML = randomRecord.totalCharge;
      document.getElementById('subtotal').innerHTML = `Subtotal: ${randomRecord.totalCharge}`;
      document.getElementById('total').innerHTML = `<strong>Total: ${randomRecord.totalCharge}</strong>`;

      document.getElementById('receipt').style.display = 'block';
      document.getElementById('printBtn').style.display = 'inline-block';
    }

    function setReceiptDate() {
      const date = new Date('2025-05-22T14:00:00+05:30');
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      document.getElementById('receiptDate').textContent = `${day}/${month}/${year}`;
    }

    setReceiptDate();

    async function downloadPDF() {
      const receipt = document.getElementById("receipt");
      const canvas = await html2canvas(receipt, { scale: 1 });
      const imgData = canvas.toDataURL("image/png");

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "pt", "a4");
      const width = pdf.internal.pageSize.getWidth();
      const height = (canvas.height * width) / canvas.width;
      pdf.addImage(imgData, "PNG", 20, 20, width - 40, height);
      
      pdf.save("Parking_Receipt.pdf");

      const pdfBase64 = pdf.output('datauristring').split(',')[1];

      const loadingMessage = document.getElementById('loadingMessage');
      loadingMessage.style.display = 'block';

      try {
        const response = await fetch('/send-receipt-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ pdfBase64: pdfBase64 }),
        });

        const result = await response.json();

        loadingMessage.style.display = 'none';

        if (result.status === 'success') {
          alert("Receipt has been sent to yaseenbepari2002@gmail.com!");
        } else {
          throw new Error(result.message || 'Failed to send email');
        }
      } catch (error) {
        loadingMessage.style.display = 'none';
        alert("Failed to send email. The receipt has been downloaded locally as 'Parking_Receipt.pdf'. Please email it to yaseenbepari2002@gmail.com manually.");
        console.error("Error sending email:", error);
      }
    }

    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.nav-links');
    hamburger.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });
  </script>
</body>
</html>